# VOLCARCH Handoff Document — 2026-02-24

## For: Codex (or any LLM continuing this work)
## From: Claude Opus 4.6

---

## 1. PROJECT OVERVIEW

**VOLCARCH** = Volcanic Taphonomic Bias in Indonesian Archaeological Records.

**Core thesis:** Active volcanism on Java buries archaeological sites at 2.4–6.2 mm/yr. The observable archaeological record is biased by survey history, not by actual settlement patterns. The "oldest kingdom" (Kutai, Kalimantan) is the most *visible*, not the oldest — because Kalimantan has zero volcanoes.

**Repo type:** Research repo, NOT software. The "product" is papers + models + maps.

**3-layer document hierarchy:**
- `docs/L1_CONSTITUTION.md` — Core hypotheses (stable, rarely changes)
- `docs/L2_STRATEGY.md` — Current research phase (changes per phase)
- `docs/L3_EXECUTION.md` — Active tasks (changes per week)
- `docs/JOURNAL.md` — Append-only research log
- `docs/EVAL.md` — Formal evaluation metrics
- `data/schema.md` — Data schema definitions

**ALWAYS read `CLAUDE.md` first** — it has the full reading order and rules.

---

## 2. CURRENT STATE (as of 2026-02-24 end of session)

### Papers

| Paper | Status | File |
|-------|--------|------|
| P1: Taphonomic Framework | Draft v0.2 COMPLETE | `papers/P1_taphonomic_framework/draft_v0.1.md` |
| P2: Settlement Suitability Model | IN PROGRESS (E007→E008→E009) | Not yet started |
| P3: Burial Depth Prediction | NOT STARTED | — |

### Experiments

| ID | Name | Status | Key Result |
|----|------|--------|------------|
| E001 | Site geocoding | COMPLETE | 666 sites, 391 geocoded |
| E002 | Eruption history | PARTIAL | 8 seed records (needs full GVP) |
| E003 | DEM acquisition | COMPLETE | Full Jawa Timur DEM + derivatives |
| E004 | Density vs volcanic proximity | COMPLETE | rho=-0.955 (survey bias) |
| E005 | Terrain suitability H1 test | COMPLETE | rho=-0.358 (H1 inconclusive) |
| E006 | Re-run with enriched data | COMPLETE | rho stable after adding 29% more sites |
| E007 | Settlement model baseline | REVISIT | **AUC=0.659**, 5 terrain features |
| E008 | Settlement model v2 | REVISIT | **AUC=0.695**, +river_dist feature |
| E009 | Settlement model v3 | **PENDING** | **← THIS IS THE NEXT TASK** |

### Key Data Files

| File | Description |
|------|------------|
| `data/processed/east_java_sites.geojson` | 391 geocoded archaeological sites |
| `data/processed/dem/jatim_dem.tif` | Elevation raster (EPSG:32749, 30m) |
| `data/processed/dem/jatim_slope.tif` | Slope in degrees |
| `data/processed/dem/jatim_twi.tif` | Topographic Wetness Index |
| `data/processed/dem/jatim_tri.tif` | Terrain Ruggedness Index |
| `data/processed/dem/jatim_aspect.tif` | Aspect in degrees |
| `data/processed/dem/jatim_river_dist.tif` | Distance to nearest river (metres) |

---

## 3. THE IMMEDIATE TASK: E009

### Problem Statement

E007 (terrain only) achieved AUC=0.659. E008 (terrain + river distance) achieved AUC=0.695.
Both BELOW the MVR (Minimum Viable Result) of AUC > 0.75 (spatial CV).
Challenge 1 (tautology test) consistently PASSES — model is tautology-free.

The model improves monotonically as features are added. But the weak spatial CV folds (2 and 3, AUC < 0.65) suggest the root cause is **survey bias**: positive samples cluster in well-surveyed areas near volcanoes, and random pseudo-absences may fall on high-suitability terrain that simply hasn't been surveyed.

### Two Candidate Approaches for E009

**Path A — Add soil data (SoilGrids) ← Simpler, try first:**
1. Download clay+silt fraction raster from SoilGrids REST API
   - Endpoint: `https://rest.isric.org/soilgrids/v2.0/properties/query`
   - Parameters: property=clay, depth=0-5cm, value=mean
   - Bounding box: lon 111–115, lat -9 to -6.5
   - Alternatively download bulk GeoTIFF from https://files.isric.org/soilgrids/latest/data/
2. Resample to match DEM grid (EPSG:32749, 30m)
3. Save as `data/processed/dem/jatim_clay.tif` and `jatim_silt.tif`
4. Add to E009 feature set: elevation, slope, TWI, TRI, aspect, river_dist, clay, silt
5. Run same spatial block CV as E007/E008
6. Target: AUC > 0.75

**Path B — Target-Group Background (TGB) pseudo-absences ← More principled:**
1. Instead of random pseudo-absences, draw background from survey-accessible areas
2. Use road density or BPCB survey polygons as survey-effort proxy
3. Pseudo-absences only placed where "surveys could have found sites but didn't"
4. This corrects for survey-bias contamination of the background sample
5. Literature: Phillips et al. 2009 "Sample selection bias and presence-only SDMs"

**Recommendation:** Try Path A first (quicker, fewer assumptions). If AUC still < 0.75, then Path B.

### MVR Decision Rules (from `docs/EVAL.md`)

- AUC > 0.75 → **Paper 2 GO** (proceed to write paper)
- AUC 0.65–0.75 → **REVISIT** (tune features or method)
- AUC < 0.65 consistently → **KILL SIGNAL** (H3 may be falsified)
- Challenge 1 must PASS (rho < 0.3 between suitability and volcano distance)
- TSS > 0.40 is secondary target

### Code Pattern

All model scripts follow the same pattern — copy E008's script and modify:
- File: `experiments/E008_settlement_model_v2/01_settlement_model_v2.py`
- Structure: load rasters → load sites → extract features → generate pseudo-absences → spatial block CV → train final model → Challenge 1 test → save results + map
- Key constants: `FEAT_COLS`, `BLOCK_SIZE_DEG=0.45`, `N_FOLDS=5`, `PSEUDOABSENCE_RATIO=5`

### Progression Table (update after E009)

```
E007: 5 features → AUC 0.659
E008: 6 features → AUC 0.695 (+0.036)
E009: 8 features → AUC ???   (target: 0.75+)
```

---

## 4. SECONDARY TASKS (lower priority)

1. **Paper 1 polish** — `papers/P1_taphonomic_framework/draft_v0.1.md` needs formal references (~20-30 citations), Figure 1 illustration, and prose cleanup
2. **Full GVP eruption data** (TASK-011) — manual download from https://volcano.si.edu/database/search_eruption_excel.cfm for Kelud, Semeru, Arjuno-Welirang, Bromo
3. **Challenge 2** (multi-source calibration) — predict burial depths for 4 anchor points within ±30%

---

## 5. RULES (from CLAUDE.md — follow these strictly)

- **Never fabricate data.** If data unavailable, document the gap.
- **Always record what you tried** in JOURNAL.md (append-only, never edit past entries).
- **Every experiment gets numbered directory** with README.md containing hypothesis, method, result, conclusion.
- **Failed experiments are NOT deleted** — documented and tagged FAILED.
- **Challenge 1 must always pass** — no volcanic proximity info in model features.
- Use Python 3.10+, prefer scripts over notebooks.
- Libraries: geopandas, rasterio, scikit-learn, xgboost, folium, scipy.

---

## 6. FILE TREE (key files only)

```
volcarch-repo/
├── CLAUDE.md                              ← READ THIS FIRST
├── docs/
│   ├── L1_CONSTITUTION.md                 ← Core hypotheses + calibration rates
│   ├── L2_STRATEGY.md                     ← Current phase + formal challenges
│   ├── L3_EXECUTION.md                    ← Active tasks (Sprint 2)
│   ├── EVAL.md                            ← Evaluation metrics + thresholds
│   └── JOURNAL.md                         ← Research log (append-only)
├── data/
│   ├── schema.md                          ← Data schema
│   ├── processed/
│   │   ├── east_java_sites.geojson        ← 391 geocoded sites
│   │   └── dem/
│   │       ├── jatim_dem.tif              ← Elevation (EPSG:32749, 30m)
│   │       ├── jatim_slope.tif
│   │       ├── jatim_twi.tif
│   │       ├── jatim_tri.tif
│   │       ├── jatim_aspect.tif
│   │       └── jatim_river_dist.tif       ← River distance (NEW in E008)
├── experiments/
│   ├── E007_settlement_suitability_model/ ← Baseline model (AUC=0.659)
│   ├── E008_settlement_model_v2/          ← +river_dist (AUC=0.695)
│   │   ├── README.md
│   │   ├── 01_settlement_model_v2.py      ← COPY THIS for E009
│   │   └── results/
│   └── E009_settlement_model_v3/          ← TO BE CREATED
├── papers/
│   └── P1_taphonomic_framework/
│       └── draft_v0.1.md                  ← Full draft v0.2
├── tools/
│   ├── compute_river_distance.py          ← OSM waterway → distance raster
│   ├── geocode_sites.py
│   ├── scrape_osm_sites.py
│   └── scrape_wikipedia_sites.py
└── requirements.txt
```
